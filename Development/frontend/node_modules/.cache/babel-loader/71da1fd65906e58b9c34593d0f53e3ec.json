{"remainingRequest":"V:\\DesignWork\\PROGRAMMING\\Tools-Specific-Projects\\Javascript\\Personal Projects\\Web Apps\\ON PROGRESS\\Emotion-Based Media Player\\client\\node_modules\\babel-loader\\lib\\index.js!V:\\DesignWork\\PROGRAMMING\\Tools-Specific-Projects\\Javascript\\Personal Projects\\Web Apps\\ON PROGRESS\\Emotion-Based Media Player\\client\\node_modules\\eslint-loader\\index.js??ref--13-0!V:\\DesignWork\\PROGRAMMING\\Tools-Specific-Projects\\Javascript\\Personal Projects\\Web Apps\\ON PROGRESS\\Emotion-Based Media Player\\client\\src\\components\\Utils\\callback.js","dependencies":[{"path":"V:\\DesignWork\\PROGRAMMING\\Tools-Specific-Projects\\Javascript\\Personal Projects\\Web Apps\\ON PROGRESS\\Emotion-Based Media Player\\client\\src\\components\\Utils\\callback.js","mtime":1607301597336},{"path":"V:\\DesignWork\\PROGRAMMING\\Tools-Specific-Projects\\Javascript\\Personal Projects\\Web Apps\\ON PROGRESS\\Emotion-Based Media Player\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"V:\\DesignWork\\PROGRAMMING\\Tools-Specific-Projects\\Javascript\\Personal Projects\\Web Apps\\ON PROGRESS\\Emotion-Based Media Player\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"V:\\DesignWork\\PROGRAMMING\\Tools-Specific-Projects\\Javascript\\Personal Projects\\Web Apps\\ON PROGRESS\\Emotion-Based Media Player\\client\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIik7Cgp2YXIgcmVxdWVzdCA9IHJlcXVpcmUoJ3JlcXVlc3QnKTsKCnZhciBxdWVyeXN0cmluZyA9IHJlcXVpcmUoJ3F1ZXJ5c3RyaW5nJyk7Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChhcHApIHsKICBhcHAuZ2V0KCcvY2FsbGJhY2snLCBmdW5jdGlvbiAocmVxLCByZXMpIHsKICAgIHZhciBjb2RlID0gcmVxLnF1ZXJ5LmNvZGUgfHwgbnVsbDsKICAgIHZhciBhdXRoT3B0aW9ucyA9IHsKICAgICAgdXJsOiAnaHR0cHM6Ly9hY2NvdW50cy5zcG90aWZ5LmNvbS9hcGkvdG9rZW4nLAogICAgICBmb3JtOiB7CiAgICAgICAgY29kZTogY29kZSwKICAgICAgICByZWRpcmVjdF91cmk6IHByb2Nlc3MuZW52LlJFRElSRUNUX1VSSSwKICAgICAgICBncmFudF90eXBlOiAnYXV0aG9yaXphdGlvbl9jb2RlJwogICAgICB9LAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5ldy1jYXAKICAgICAgICBBdXRob3JpemF0aW9uOiAiQmFzaWMgIi5jb25jYXQobmV3IEJ1ZmZlci5mcm9tKCIiLmNvbmNhdChwcm9jZXNzLmVudi5DTElFTlRfSUQsICI6IikuY29uY2F0KHByb2Nlc3MuZW52LkNMSUVOVF9TRUNSRVQpKS50b1N0cmluZygnYmFzZTY0JykpCiAgICAgIH0sCiAgICAgIGpzb246IHRydWUKICAgIH07CiAgICByZXF1ZXN0LnBvc3QoYXV0aE9wdGlvbnMsIGZ1bmN0aW9uIChlcnJvciwgcmVzcG9uc2UsIGJvZHkpIHsKICAgICAgaWYgKCFlcnJvciAmJiByZXMuc3RhdHVzQ29kZSA9PT0gMjAwKSB7CiAgICAgICAgcmVzLmNvb2tpZShwcm9jZXNzLmVudi5BQ0NFU1NfVE9LRU4sIGJvZHkuYWNjZXNzX3Rva2VuKTsKICAgICAgICByZXMuY29va2llKHByb2Nlc3MuZW52LlJFRlJFU0hfVE9LRU4sIGJvZHkucmVmcmVzaF90b2tlbik7CiAgICAgICAgcmVzLmNvb2tpZShwcm9jZXNzLmVudi5SRUZSRVNIX0NPREUsIGNvZGUpOwoKICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgcmVzLnJlZGlyZWN0KCIiLmNvbmNhdChwcm9jZXNzLmVudi5QUk9KRUNUX1JPT1QsICIvaG9tZSIpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzLnJlZGlyZWN0KCdodHRwOi8vbG9jYWxob3N0OjgwODAvaG9tZScpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXMucmVkaXJlY3QoIi8jIi5jb25jYXQocXVlcnlzdHJpbmcuc3RyaW5naWZ5KHsKICAgICAgICAgIGVycm9yOiAnaW52YWxpZF90b2tlbicKICAgICAgICB9KSkpOwogICAgICB9CiAgICB9KTsKICB9KTsKfTs="},{"version":3,"sources":["V:/DesignWork/PROGRAMMING/Tools-Specific-Projects/Javascript/Personal Projects/Web Apps/ON PROGRESS/Emotion-Based Media Player/client/src/components/Utils/callback.js"],"names":["request","require","querystring","module","exports","app","get","req","res","code","query","authOptions","url","form","redirect_uri","process","env","REDIRECT_URI","grant_type","headers","Authorization","Buffer","from","CLIENT_ID","CLIENT_SECRET","toString","json","post","error","response","body","statusCode","cookie","ACCESS_TOKEN","access_token","REFRESH_TOKEN","refresh_token","REFRESH_CODE","NODE_ENV","redirect","PROJECT_ROOT","stringify"],"mappings":";;;;;;AAAA,IAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AACA,IAAMC,WAAW,GAAGD,OAAO,CAAC,aAAD,CAA3B;;AAEAE,MAAM,CAACC,OAAP,GAAiB,UAACC,GAAD,EAAS;AACxBA,EAAAA,GAAG,CAACC,GAAJ,CAAQ,WAAR,EAAqB,UAACC,GAAD,EAAMC,GAAN,EAAc;AACjC,QAAMC,IAAI,GAAGF,GAAG,CAACG,KAAJ,CAAUD,IAAV,IAAkB,IAA/B;AAEA,QAAME,WAAW,GAAG;AAClBC,MAAAA,GAAG,EAAE,wCADa;AAElBC,MAAAA,IAAI,EAAE;AACJJ,QAAAA,IAAI,EAAJA,IADI;AAEJK,QAAAA,YAAY,EAAEC,OAAO,CAACC,GAAR,CAAYC,YAFtB;AAGJC,QAAAA,UAAU,EAAE;AAHR,OAFY;AAOlBC,MAAAA,OAAO,EAAE;AACP;AACAC,QAAAA,aAAa,kBAAW,IAAIC,MAAM,CAACC,IAAX,WAAmBP,OAAO,CAACC,GAAR,CAAYO,SAA/B,cAA4CR,OAAO,CAACC,GAAR,CAAYQ,aAAxD,GAAyEC,QAAzE,CAAkF,QAAlF,CAAX;AAFN,OAPS;AAWlBC,MAAAA,IAAI,EAAE;AAXY,KAApB;AAcA1B,IAAAA,OAAO,CAAC2B,IAAR,CAAahB,WAAb,EAA0B,UAACiB,KAAD,EAAQC,QAAR,EAAkBC,IAAlB,EAA2B;AACnD,UAAI,CAACF,KAAD,IAAUpB,GAAG,CAACuB,UAAJ,KAAmB,GAAjC,EAAsC;AACpCvB,QAAAA,GAAG,CAACwB,MAAJ,CAAWjB,OAAO,CAACC,GAAR,CAAYiB,YAAvB,EAAqCH,IAAI,CAACI,YAA1C;AACA1B,QAAAA,GAAG,CAACwB,MAAJ,CAAWjB,OAAO,CAACC,GAAR,CAAYmB,aAAvB,EAAsCL,IAAI,CAACM,aAA3C;AACA5B,QAAAA,GAAG,CAACwB,MAAJ,CAAWjB,OAAO,CAACC,GAAR,CAAYqB,YAAvB,EAAqC5B,IAArC;;AAEA,YAAIM,OAAO,CAACC,GAAR,CAAYsB,QAAZ,KAAyB,YAA7B,EAA2C;AACzC9B,UAAAA,GAAG,CAAC+B,QAAJ,WAAgBxB,OAAO,CAACC,GAAR,CAAYwB,YAA5B;AACD,SAFD,MAEO;AACLhC,UAAAA,GAAG,CAAC+B,QAAJ,CAAa,4BAAb;AACD;AACF,OAVD,MAUO;AACL/B,QAAAA,GAAG,CAAC+B,QAAJ,aAAkBrC,WAAW,CAACuC,SAAZ,CAAsB;AAAEb,UAAAA,KAAK,EAAE;AAAT,SAAtB,CAAlB;AACD;AACF,KAdD;AAeD,GAhCD;AAiCD,CAlCD","sourcesContent":["const request = require('request');\nconst querystring = require('querystring');\n\nmodule.exports = (app) => {\n  app.get('/callback', (req, res) => {\n    const code = req.query.code || null;\n\n    const authOptions = {\n      url: 'https://accounts.spotify.com/api/token',\n      form: {\n        code,\n        redirect_uri: process.env.REDIRECT_URI,\n        grant_type: 'authorization_code',\n      },\n      headers: {\n        // eslint-disable-next-line new-cap\n        Authorization: `Basic ${new Buffer.from(`${process.env.CLIENT_ID}:${process.env.CLIENT_SECRET}`).toString('base64')}`,\n      },\n      json: true,\n    };\n\n    request.post(authOptions, (error, response, body) => {\n      if (!error && res.statusCode === 200) {\n        res.cookie(process.env.ACCESS_TOKEN, body.access_token);\n        res.cookie(process.env.REFRESH_TOKEN, body.refresh_token);\n        res.cookie(process.env.REFRESH_CODE, code);\n\n        if (process.env.NODE_ENV === 'production') {\n          res.redirect(`${process.env.PROJECT_ROOT}/home`);\n        } else {\n          res.redirect('http://localhost:8080/home');\n        }\n      } else {\n        res.redirect(`/#${querystring.stringify({ error: 'invalid_token' })}`);\n      }\n    });\n  });\n};\n"]}]}